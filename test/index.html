<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="test.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.6.0/gsap.min.js"></script>
  <script src="https://kit.fontawesome.com/9cc122fcab.js" crossorigin="anonymous"></script>
</head>

<body>
  <div class="ciclegraph">
    <i class="fas fa-arrow-circle-up fa-2x arrow"></i>
    <!-- <div class="linegraph"> -->
    <div class="line"></div>
    <div class="line"></div>
    <div class="line"></div>
    <div class="line"></div>
    <div class="line"></div>
    <div class="line"></div>
    <div class="line"></div>
    <div class="line"></div>
    <div class="circle"><span>1</span></div>
    <div class="circle"><span>2</span></div>
    <div class="circle"><span>3</span></div>
    <div class="circle"><span>4</span></div>
    <div class="circle"><span>5</span></div>
    <div class="circle"><span>6</span></div>
    <div class="circle"><span>7</span></div>
    <div class="circle"><span>8</span></div>
  </div>

  <button class="spin">
    spin
  </button>
  <script>
    let angle_list = {};
    let arrow = document.querySelector(".arrow")
    document.querySelectorAll('.ciclegraph').forEach((ciclegraph) => {
      let circles = ciclegraph.querySelectorAll('.circle')
      let angle = 360 - 90, dangle = 360 / circles.length
      for (let i = 0; i < circles.length; ++i) {
        let circle = circles[i]
        angle += dangle
        angle_list[`task${i + 1}`] = angle
        //  TODO: use inner width for it to be responsive
        circle.style.transform = `rotate(${angle}deg) translate(${ciclegraph.clientWidth / 5}px) rotate(-${angle}deg)`



      }
      // arrow.style.transform = "rotate(45deg)"
      let lines = ciclegraph.querySelectorAll(".line")
      let langle = 293.5, ldangle = 360 / lines.length
      for (let i = 0; i < lines.length; ++i) {
        let line = lines[i]
        langle += ldangle
        line.style.transform = `rotate(${langle}deg)`
        line.style.transform = `rotate(${langle}deg) translate(${ciclegraph.clientWidth / 5}px) `

      }
    })


    document.querySelector(".spin").addEventListener("click", function () {
      console.log("Im getting clicked");
      const TEMP_ANGLE = 2115
      gsap.to(".arrow", 4, { rotation: TEMP_ANGLE, ease: Power4.easeOut, onComplete: determineTask })


      // Determine what task was selected

      function determineTask() {
        for (const task in angle_list) {
          if (angle_list[task] % 360 + 90 == TEMP_ANGLE % 360) {
            console.log(task)
            alert(task)
          }
        }
      }


    });
  </script>


</body>

</html>